{% extends 'templates/base.html' %}
{% load static %}
{% load jformat %}
{% load humanize %}

{% block head %}
    <meta name="description" content="{{ product.meta_description }}"/>
    <meta name="robots" content="index, follow" />
    <meta name="canonical" content="https://hmelecteronic.ir/shop/product/{{ product.id }}/{{ product.slug }}" />
    <title>{{ product.product_name }}-اچ ام الکترونیک</title>
{% endblock %}

{% block main %}
    <script>
        function setDiscount(realPrice, specialPrice, elemId){
            let newPriceElements = document.getElementsByClassName(`product${elemId}`);
            let discountPrice = realPrice - specialPrice
            let discountPercent = (discountPrice * 100) / realPrice
            discountPercent = Math.round(discountPercent)
            for (let elem of newPriceElements){
                elem.innerHTML = `${discountPercent}%`;
            }
        }
    </script>


<!-- start breadcroumb -->
    <div class="bread-crumb pt-3">
        <div class="container-fluid">
            <div class="content-box">
                <div class="container-fluid">
                    <nav aria-label="breadcrumb" class="my-lg-0 my-2">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="{% url 'main:Home_page' %}" class="font-14 text-muted">خانه</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'product:shop_page' %}" class="font-14 text-muted">فروشگاه</a></li>
                        <li class="breadcrumb-item active main-color-one-color font-14" aria-current="page">{{ product.product_name }}</li>
                    </ol>
                </nav>
                </div>
            </div>
        </div>
    </div>
    <!-- end breadcroumb -->

    <!-- start product meta -->
    <div class="product-meta py-20">
        <div class="container-fluid">
            <div class="content-box">
                <div class="container-fluid">
                    <div class="row gy-3">
                        <div class="col-lg-4">
                            <div class="pro_gallery">
                                <div class="icon-product-box">
                                    <div class="icon-product-box-item" data-bs-toggle="modal" data-bs-target="#shareModal" data-bs-placement="right" title="اشتراک گذاری">
                                        <i class="bi bi-share"></i>
                                    </div>
                                </div>
                                <div class="swiper product-gallery">
                                    <div class="swiper-wrapper" title="برای بزرگنمایی تصویر دابل کلیک کنید">
                                        {% for image in product.images.all %}
                                            <div class="swiper-slide">
                                                <div class="swiper-zoom-container">
                                                    <img class="img-fluid" src="{{ image.img.url }}" alt="main image{{ image.id }}">
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    <div class="swiper-button-next d-none d-lg-flex"></div>
                                    <div class="swiper-button-prev d-none d-lg-flex"></div>
                                    <div class="swiper-pagination d-none d-lg-block"></div>
                                </div>
                                <div class="swiper product-gallery-thumb">
                                    <div class="swiper-wrapper">
                                        {% for image in product.images.all %}
                                            <div class="swiper-slide">
                                                <img class="img-fluid" src="{{ image.img.url }}" alt="footer image{{ image.id }} ">
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-8">
                            <div class="product-meta-title">
                                <div class="row align-items-baseline gy-3">
                                    <div class="col-lg-8">
                                        <h1 class="font-16">{{ product.product_name }}</h1>
                                        {% if product.subtitle %}
                                            <h2 class="mb-0 mt-2 text-muted font-14">{{ product.subtitle }}</h2>
                                        {% endif %}
                                    </div>
                                    {% if product.brand %}
                                        <div class="col-lg-4">
                                            {% if product.brand.url_address %}
                                                <a href="{{ product.brand.url_address }}" title="{{ product.brand.brand_name }}" target="_blank" class="text-lg-end d-block">
                                                    <img src="{{ product.brand.img.url }}" alt="{{ product.brand.brand_name }}" class="img-fluid">
                                                </a>
                                            {% else %}
                                                <div class="text-lg-end d-block" title="{{ product.brand.brand_name }}">
                                                    <img src="{{ product.brand.img.url }}" alt="{{ product.brand.brand_name }}" class="img-fluid">
                                                </div>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="product-meta-feature">
                                <div class="row gy-3">
                                    <div class="col-lg-8">
                                        <div class="product-meta-feature-items">
                                            <h5 class="title font-16 mb-2">خلاصه توضیحات</h5>
                                            {{ product.property|safe }}
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="product-meta-rating">
                                            <div class="d-flex align-items-center justify-content-lg-end">
                                                <div class="count-comment text-muted">{{ product.comments.count }} دیدگاه</div>
                                                {% if product.selected_product %}
                                                    <div class="count-rating">
                                                        <img src="{% static 'image/star.png' %}" alt="star logo" height="25px" width="25px" title="محصول برگزیده">
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="product-meta-garanty justify-content-lg-end justify-content-start">
                                            <span>شناسه محصول: {{ product.id|add:1000 }}</span>
                                        </div>
                                        <div class="product-meta-garanty justify-content-lg-end justify-content-start">
                                            <span>تعداد محصول موجود: {{ product.number_of_product }}</span>
                                        </div>
                                        <div class="product-meta-garanty justify-content-lg-end justify-content-start">
                                            <i class="bi bi-shield-fill-check"></i>
                                            <span class="text-muted"> گارانتی اصالت و سلامت فیزیکی کالا</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% if product.tipA.all and product.status %}
                                <div class="product-meta-count">
                                    <label for="reizan-tip" class="mr-2">تیپ محصول:</label>
                                    <select id="reizan-tip" class="btn" style="background-color: #e8e8e8">
                                        <option value="B" selected>تیپ B</option>
                                        <option value="A">تیپ A</option>
                                    </select>
                                </div>
                            {% endif %}
                            {% if product.status %}
                                <div class="product-meta-action">
                                    {% if product.special_price %}
                                        <div class="row align-items-center gy-3">
                                            <div class="col-lg-3 col-6 w-100-in-400">
                                                <p class="mb-0 old-price font-16 text-lg-end text-center">{{ product.price|intcomma:False }} تومان</p>
                                            </div>
                                            <div class="col-lg-3 col-6 w-100-in-400">
                                                <h6 class="font-16 new-price main-color-one-color">{{ product.special_price|intcomma:False }} تومان</h6>
                                            </div>
                                            <div class="col-lg-3 col-6 w-100-in-400">
                                                <div class="counter counter1">
                                                    <input type="text" name="count" class="counter" value="1">
                                                </div>
                                            </div>
                                            <div class="col-lg-3 col-6 w-100-in-400">
                                                <div class="d-flex justify-content-center">
                                                    {% if product.disable_order %}
                                                        <button class="btn w-100 border-0 main-color-three-bg" onclick="disableOrder()">
                                                            <i class="bi bi-basket text-white font-20 me-1"></i>خرید کالا
                                                        </button>
                                                    {% else %}
                                                        <button class="btn w-100 border-0 main-color-three-bg" onclick="addToCart(1)">
                                                            <i class="bi bi-basket text-white font-20 me-1"></i>خرید کالا
                                                        </button>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="row align-items-center gy-3">
                                            <div class="col-lg-4 col-6 w-100-in-400 text-center">
                                                <h6 class="font-16 new-price main-color-one-color new-product-price">{{ product.price|intcomma:False }} تومان</h6>
                                            </div>
                                            <div class="col-lg-4 col-6 w-100-in-400">
                                                <div class="counter counter1">
                                                    <input type="text" name="count" class="counter" value="1">
                                                </div>
                                            </div>
                                            <div class="col-lg-4 col-12 w-100-in-400">
                                                <div class="d-flex justify-content-center">
                                                    {% if product.disable_order %}
                                                        <button class="btn w-100 border-0 main-color-three-bg" onclick="disableOrder()">
                                                            <i class="bi bi-basket text-white font-20 me-1"></i>خرید کالا
                                                        </button>
                                                    {% else %}
                                                        <button class="btn w-100 border-0 main-color-three-bg" onclick="addToCart(1)">
                                                            <i class="bi bi-basket text-white font-20 me-1"></i>خرید کالا
                                                        </button>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                            {% else %}
                                <div class="product-meta-action">
                                    <div class="row align-items-center gy-3">
                                        <div class="col-12 w-100-in-400">
                                            <div class="d-flex justify-content-center">
                                                <button class="btn w-100 border-0 btn-danger disabled">
                                                    <i class="bi bi-x-circle text-white font-20 me-1"></i>ناموجود است
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end product meta -->

    <!-- start product desc -->
    <div class="product-desc py-20">
        <div class="container-fluid">
            <div class="row gy-3">
                <div class="col-lg-9">
                    <div class="content-box">
                        <div class="container-fluid">
                            <div class="product-descs" id="prodesc">
                                <div class="product-desc">
                                    <div class="product-desc-tab">
                                        <ul class="nav" id="productTab" role="tablist">
                                            <li class="nav-item">
                                                <button class="active waves-effect waves-light" id="productDescLess"
                                                    data-bs-toggle="tab" data-bs-target="#productDescLess-pane" role="tab"
                                                    type="button" aria-selected="true"><a data-toggle="tab"
                                                        href="#productDescLess-pane">توضیحات محصول</a></button>
                                            </li>
                                            <li class="nav-item">
                                                <button class=" waves-effect waves-light" id="productTable"
                                                    data-bs-toggle="tab" data-bs-target="#productTable-pane" role="tab"
                                                    type="button" aria-selected="false"><a data-toggle="tab"
                                                        href="#productTable-pane"> توضیحات
                                                        تکمیلی</a></button>
                                            </li>
                                            <li class="nav-item">
                                                <button class=" waves-effect waves-light" id="productComment"
                                                    data-bs-toggle="tab" data-bs-target="#productComment-pane" role="tab"
                                                    type="button" aria-selected="false"><a data-toggle="tab"
                                                        href="#productComment-pane">نظرات</a></button>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="product-desc-tab-content">
                                        <div class="tab-content" id="productTabContent">
                                            <div class="tab-pane fade show active product-desc-less-contents" id="productDescLess-pane">
                                                <div class="product-desc-content">
                                                    {{ product.description|safe }}
                                                </div>
                                            </div>
                                            <div class="tab-pane fade" id="productTable-pane">
                                                <div class="tab-pane fade active show" id="productTable-pane" role="tabpanel" aria-labelledby="#productTable">
                                                    <h6 class="font-26 mb-2">مشخصات فنی</h6>
                                                    {% for key, value in product.technical_specs.items %}
                                                    <div class="box_list mt-4">
                                                        <p class="title">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-left-fill" viewBox="0 0 16 16">
                                                                <path d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"></path>
                                                            </svg>
                                                            {{ key }}
                                                        </p>
                                                        <section>
                                                            <ul class="param_list list-inline">
                                                                <div class="container-fluid">
                                                                    {% for m, n in value.items %}
                                                                    <div class="row ps-md-2">
                                                                        <li
                                                                            class="list-inline-item col-md-3 pe-md-1 pe-md-3 p-0 m-0">
                                                                            <div class="box_params_list">
                                                                                <p class="block border_right_custom1">{{ m }}</p>
                                                                            </div>
                                                                        </li>
                                                                        <li class="list-inline-item col-md-8 p-0 m-0">
                                                                            <div class="box_params_list">
                                                                                <p class="block border_right_custom2">{{ n }}</p>
                                                                            </div>
                                                                        </li>
                                                                    </div>
                                                                    {% endfor %}
                                                                </div>
                                                            </ul>
                                                        </section>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                            <div class="tab-pane fade product-comment-content" id="productComment-pane">
                                                <div class="comment-form">
                                                    <h6 class="font-26 mb-2">نظرت در مورد این محصول چیه؟</h6>
                                                    {% if not request.user.is_authenticated %}
                                                        <p class="font-14 mt-2 text-danger">* برای ثبت نظر ابتدا باید وارد
                                                            <a href="{% url 'account:login' %}" class="main-color-one-color" style="text-decoration: underline">حساب کاربری</a>
                                                            خود شوید
                                                        </p>
                                                    {% endif %}
                                                    <div class="row gy-4">
                                                        <div class="col-12">
                                                            <div class="row">
                                                                <div class="col-12">
                                                                    <div class="comment-item my-3">
                                                                        <textarea placeholder="نظر خود را وارد کنید" class="form-control" id="comment-text-area" style="height: 150px"></textarea>
                                                                    </div>
                                                                </div>
                                                                {% if request.user.is_authenticated %}
                                                                <div class="col-12">
                                                                    <button id="comment-submit-btn" class="btn btn-comment font-14 border-0 main-color-one-bg my-3 mx-auto btn-lg waves-effect waves-light">
                                                                        ثبت نظر
                                                                    </button>
                                                                </div>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% for comment in product.comments.all %}
                                                    <div class="comment bg-light shadow-inner mb-4">
                                                    <div class="title">
                                                        <div class="row align-items-center">
                                                            <div class="col-sm-10">
                                                                <div class="d-flex align-items-center">
                                                                    <div class="d-flex flex-wrap align-items-center ms-2">
                                                                        <h6 class="text-muted font-14">{{ comment.user.first_name }} {{ comment.user.last_name }}</h6>
                                                                        <h6 class="text-muted font-14 ms-2">{{ comment.created_at|jformat:'%Y/%m/%d' }}</h6>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="desc py-3">
                                                        <p class="font-14 text-muted">{{ comment.text }}</p>
                                                    </div>
                                                    <div class="foot">
                                                        {% for reply in comment.replies.all %}
                                                        <div class="comment comment-replay shadow-inner mt-0">
                                                            <div class="title">
                                                                <div class="row align-items-center">
                                                                    <div class="col-sm-10">
                                                                        <div class="d-flex align-items-center">
                                                                            <div class="avatar p-2 bg-white shadow-box rounded-circle">
                                                                                <img src="{% static 'image/user.png' %}" alt="user profile" class="img-fluid rounded-circle">
                                                                            </div>
                                                                            <div
                                                                                class="d-flex flex-wrap align-items-center ms-2">
                                                                                <h6 class="text-muted font-14">{{ reply.responder_name_persistent }}</h6>
                                                                                <h6 class="text-muted font-14 ms-2">{{ reply.created_at|jformat:'%Y/%m/%d' }}</h6>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="desc py-3">
                                                                <p class="font-14 text-muted">{{ reply.text }}</p>
                                                            </div>
                                                        </div>
                                                        {% endfor %}
                                                    </div>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 d-lg-block d-none position-relative">
                    <div class="content-box top-0 position-sticky">
                        <div class="container-fluid">
                            <div class="product-float">
                                <div class="product-float-title">
                                    <div class="row align-items-center gy-2">
                                        <div class="col-4">
                                            <div class="image">
                                                {% for image in product.images.all|slice:':1' %}
                                                <img src="{{ image.img.url }}" alt="sticky image{{ image.id }}" class="img-fluid">
                                                {% endfor %}
                                            </div>
                                        </div>
                                        <div class="col-8">
                                            <div class="title">
                                                <h6 class="font-14">{{ product.product_name }}</h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% if product.brand %}
                                <div class="product-float-brand my-3">
                                    {% if product.brand.url_address %}
                                        <a href="{{ product.brand.url_address }}" class="d-inline">
                                            <img src="{{ product.brand.img.url }}" alt="image {{ product.brand.brand_name }}" class="img-fluid">
                                            <p class="mb-0 mr-2 d-inline">{{ product.brand.brand_name }}</p>
                                        </a>
                                    {% else %}
                                        <img src="{{ product.brand.img.url }}" alt="image {{ product.brand.brand_name }}" class="img-fluid">
                                        <p class="mb-0 mr-2 d-inline">{{ product.brand.brand_name }}</p>
                                    {% endif %}
                                </div>
                                {% endif %}
                                <div class="product-meta-rating">
                                    <div class="d-flex align-items-center">
                                        <div class="count-comment text-muted">{{ product.comments.count }} دیدگاه</div>
                                        {% if product.selected_product %}
                                        <div class="count-rating">
                                            <img src="{% static 'image/star.png' %}" width="20px" height="20px" alt="star logo2" title="محصول برگزیده">
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="product-meta-garanty justify-content-start">
                                    <span>تعداد محصول موجود: {{ product.number_of_product }}</span>
                                </div>
                                <div class="product-meta-garanty justify-content-start">
                                    <i class="bi bi-shield-fill-check"></i>
                                    <span class="text-muted"> گارانتی اصالت و سلامت فیزیکی کالا</span>
                                </div>
                                {% if product.status %}
                                    <div class="product-float-price product-meta-action p-0 bg-transparent shadow-none">
                                        <div class="row gy-3">
                                            {% if product.special_price %}
                                                <div class="col-6 w-100-in-400">
                                                    <p class="mb-0 old-price font-16 text-start">{{ product.price|intcomma:False }} تومان</p>
                                                </div>
                                                <div class="col-6 w-100-in-400">
                                                    <h6 class="font-16 new-price main-color-one-color">{{ product.special_price|intcomma:False }} تومان</h6>
                                                </div>
                                            {% else %}
                                                <div class="col-12 w-100-in-400 text-center">
                                                    <h6 class="font-16 new-price main-color-one-color new-product-price">{{ product.price|intcomma:False }} تومان</h6>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="product-float-action product-meta-action p-0 bg-transparent shadow-none">
                                        <div class="row gy-3">
                                            <div class="col-12 w-100-in-400">
                                                <div class="counter counter2">
                                                    <input type="text" name="count" class="counter" value="1">
                                                </div>
                                            </div>
                                            <div class="col-12 w-100-in-400">
                                                <div class="d-flex justify-content-center">
                                                    {% if product.disable_order %}
                                                        <button class="btn w-100 border-0 main-color-three-bg" onclick="disableOrder()">
                                                            <i class="bi bi-basket text-white font-20 me-1"></i>خرید کالا
                                                        </button>
                                                    {% else %}
                                                        <button class="btn w-100 border-0 main-color-three-bg" onclick="addToCart(2)">
                                                            <i class="bi bi-basket text-white font-20 me-1"></i>خرید کالا
                                                        </button>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="product-float-action product-meta-action p-0 bg-transparent shadow-none">
                                        <div class="row gy-3">
                                            <div class="col-12 w-100-in-400">
                                                <div class="d-flex justify-content-center">
                                                    <button class="btn w-100 border-0 btn-danger disabled">
                                                        <i class="bi bi-x-circle text-white font-20 me-1"></i>ناموجود است
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end product desc -->

    <!-- start product slider -->
    {% if similar_products %}
    <div class="product-slider site-slider py-20">
        <div class="container-fluid">
            <div
                class="header-content mb-4 bg-white shadow-box rounded-3 p-3 d-flex align-items-center justify-content-between flex-wrap">
                <div class="title d-flex align-items-center">
                    <img src="{% static 'image/square.png' %}" alt="square" class="img-fluid">
                    <h5 class="font-16 ms-3">
                        <span class="main-color-one-color d-inline-block ms-1">محصولات</span> مشابه
                    </h5>
                </div>
            </div>
        </div>

        <div class="parent">
            <div class="container-fluid">
                <div class="swiper" id="product-slider">
                    <div class="swiper-wrapper">
                        {% for product in similar_products %}
                            {% if product.status %}
                                <div class="swiper-slide">
                                    <div class="product-box ">
                                        <div class="product-timer">
                                            {% if product.special_price %}
                                                <div class="timer-label">
                                                    <span class="product{{ product.id }}"></span>
                                                    <script>setDiscount({{ product.price }}, {{ product.special_price }}, {{ product.id }})</script>
                                                </div>
                                            {% endif %}
                                            {% if product.selected_product %}
                                                <div>
                                                    <img src="{% static 'image/star.png' %}" class="img-fluid" width="31px" alt="star logo" title="محصول برگزیده">
                                                </div>
                                            {% endif %}
                                        </div>
                                        <a href="{% url 'product:productDetail_page' product.id product.slug %}" title="{{ product.product_name }}">
                                            <div class="product-image">
                                                {% if product.images.count > 1 %}
                                                    {% for image in product.images.all|slice:':2' %}
                                                        <img src="{{ image.img.url }}" loading="lazy"
                                                             alt="{{ product.product_name }}{% cycle '1' '2' %}"
                                                             class="img-fluid {% cycle 'one-image' 'two-image' %}"
                                                        >
                                                    {% endfor %}
                                                {% else %}
                                                    {% for image in product.images.all|slice:':1' %}
                                                        <img src="{{ image.img.url }}" loading="lazy" alt="{{ product.product_name }}" class="img-fluid">
                                                    {% endfor %}
                                                {% endif %}
                                            </div>
                                        </a>
                                        <div class="product-title">
                                            <a href="{% url 'product:productDetail_page' product.id product.slug %}">
                                                <div class="title">
                                                    <p class="text-overflow-1">{{ product.product_name }}</p>
                                                    {% if product.subtitle %}
                                                        <span class="text-muted text-overflow-1">{{ product.subtitle }}</span>
                                                    {% endif %}
                                                </div>
                                            </a>
                                        </div>
                                        <div class="product-action">
                                            <div class="price">
                                                {% if product.special_price %}
                                                    <p class="new-price">{{ product.special_price|intcomma:False }} تومان</p>
                                                    <p class="old-price">{{ product.price|intcomma:False }} تومان</p>
                                                {% else %}
                                                    <p class="new-price">{{ product.price|intcomma:False }} تومان</p>
                                                {% endif %}
                                            </div>
                                            <div class="link">
                                                {% if product.disable_order %}
                                                    <a href="#" onclick="disableOrder()" class="btn border-0 rounded-3 main-color-one-bg" role="button">
                                                        <i class="bi bi-basket text-white"></i>
                                                        <span class="text-white">خرید محصول</span>
                                                    </a>
                                                {% else %}
                                                    <a href="{% url 'cart:addToCart' product.id %}" class="btn border-0 rounded-3 main-color-one-bg" role="button">
                                                        <i class="bi bi-basket text-white"></i>
                                                        <span class="text-white">خرید محصول</span>
                                                    </a>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    <!-- end product slider -->

    <!-- modal shahre -->
    <div class="share-modal">
        <div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-sm modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h6 class="modal-title" id="exampleModalLabel">اشتراک گذاری</h6>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <h4 class="font-14 my-3">این کالا را با دوستان خود به اشتراک بگذارید!</h4>
                        <button type="button" class="btn d-block text-center main-color-one-bg w-100" id="liveToastBtn">
                            <i class="bi bi-clipboard text-white me-1"></i>
                            کپی کردن لینک
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--end modal share-->

    <script>
    // COMMENT SECTION START
    {% if request.user.is_authenticated %}
        let submitBtn = document.getElementById('comment-submit-btn');
        let textArea = document.getElementById('comment-text-area');
        submitBtn.addEventListener('click', () => {
            if (textArea.value) {
                $.ajax({
                    url: '{% url "product:productDetail_page" product.id product.slug %}',
                    type: 'POST',
                    data: {
                        'text': textArea.value
                    },
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
                    },
                    success: function (response){
                        if (response.status === 200) {
                            Swal.fire({
                                position: 'top-start',
                                icon: 'success',
                                title: 'نظر شما با موفقیت ثبت شد',
                                showConfirmButton: false,
                                timer: 1500
                            }).then(() => {
                                window.location.reload();
                            })
                        } else if (response.status === 401) {
                            Swal.fire({
                                icon: 'error',
                                title: 'خطای احراز هویت',
                                text: 'برای ثبت نظر خود باید وارد حساب کاربریتان شوید!',
                                footer: `<a href="{% url 'account:login' %}">حساب کاربری دارید ؟</a>`,
                                confirmButtonColor: '#3085d6',
                            });
                            textArea.value = '';
                        } else if (response.status === 400) {
                            Swal.fire({
                                icon: 'error',
                                text: 'فرم معتبر نمی باشد ! ',
                                confirmButtonColor: '#3085d6',
                            });
                            textArea.value = '';
                        }
                    }
                })
            } else {
                textArea.classList.add('border-danger', 'border-2')
                textArea.focus();
            }
        })
    {% endif %}
    // COMMENT SECTION END

    // ADD TO CART SECTION START
        let reizanTips = document.getElementById('reizan-tip');
        function outOfEntity(number_of_product){
            Swal.fire({
                icon: 'error',
                text: `تعداد محصول انتخاب شده بیشتر از موجودیت محصول است. موجودیت: ${number_of_product} عدد`,
                confirmButtonColor: '#3085d6',
            })
        }
        function addToCart(counterNumber){
            let quantity;
            let number_of_product = {{ product.number_of_product }};
            counterNumber === 2 ? quantity = document.querySelector('.counter2 input').value : quantity = document.querySelector('.counter1 input').value;
            if (Number(quantity) > number_of_product) {
                outOfEntity(number_of_product);
            } else {
                let data = {'quantity': quantity}
                if (document.contains(reizanTips)) data['tip'] = reizanTips.value;
                $.ajax({
                    url: '{% url "cart:addToCart" product.id %}',
                    type: 'POST',
                    data: data,
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
                    },
                    success: function (response){
                        if (response.status === 200) {
                            Swal.fire({
                                position: 'top-start',
                                icon: 'success',
                                title: 'با موفقیت به سبد خرید شما اضافه شد',
                                showConfirmButton: false,
                                timer: 1500
                            }).then(() => {
                                window.location.assign('{% url "cart:detail_page" %}')
                            })
                        }
                        else if (response.status === 400) {
                            outOfEntity(number_of_product);
                        }
                        else {
                            Swal.fire({
                                icon: 'error',
                                text: 'محصول یافت نشد !',
                                confirmButtonColor: '#3085d6',
                            })
                        }
                    },
                    error: function (error){
                        Swal.fire({
                            icon: 'error',
                            title: error.code,
                            text: 'خطایی رخ داده است! وضعیت اینترنت خود را بررسی کنید و دوباره امتحان کنید. در صورت برطرف نشدن مشکل با پشتیبانی تماس بگیرید.',
                            confirmButtonColor: '#3085d6',
                        })
                        console.log(error)
                    }
                })
            }
        }
    // ADD TO CART SECTION END

    // REIZAN PRODUCT SECTION START - CHANGE PRODUCT TIP
        {% if product.tipA.all and product.status %}
            let NewPriceElems = document.querySelectorAll('.new-product-price');
            console.log(NewPriceElems)
            reizanTips.addEventListener('change', () => {
                let tip = reizanTips.value;
                $.ajax({
                    url: '{% url 'product:show_reizan_tip' product.slug %}',
                    type: 'POST',
                    data: {
                        'tip': tip,
                    },
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
                    },
                    success: function (response){
                        if (response.status === 200){
                            for (let priceElem of NewPriceElems){
                                priceElem.innerHTML = `${response.price} تومان`
                            }
                        }
                        else if (response.status === 404) {
                            addToCartBtn.classList.add('disabled');
                            addToCartBtn.removeEventListener('click', addToCart);
                            Swal.fire({
                                icon: 'error',
                                text: 'محصول یافت نشد !',
                                confirmButtonColor: '#3085d6',
                            })
                        }
                        else if (response.status === 400){
                            Swal.fire({
                                icon: 'error',
                                text: 'خطایی رخ داده است !',
                                confirmButtonColor: '#3085d6',
                            })
                        }
                    },
                    error: function (err){
                        Swal.fire({
                            icon: 'error',
                            title: err.code,
                            text: 'خطایی رخ داده است! وضعیت اینترنت خود را بررسی کنید و دوباره امتحان کنید. در صورت برطرف نشدن مشکل با پشتیبانی تماس بگیرید.',
                            confirmButtonColor: '#3085d6',
                        })
                        console.log(err)
                    }
                })
            })
        {% endif %}
    // REIZAN PRODUCT SECTION END - CHANGE PRODUCT TIP

    // SHARE SECTION START
    let copyUrl = document.querySelector('.share-modal #liveToastBtn');
    copyUrl.addEventListener('click', () => {
         let productUrl = '{{ product.get_absolute_url }}';
         copyUrl.innerHTML = '<i class="bi bi-check-circle text-white me-1"></i> لینک کپی شد';
         copyUrl.classList.remove('main-color-one-bg');
         copyUrl.classList.add('main-color-three-bg');
         navigator.clipboard.writeText(`https://hmelecteronic.ir${productUrl}`);
    })
    // SHARE SECTION END
    </script>

{% endblock %}